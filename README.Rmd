---
  output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

## Overview

`mrgda` assists with deriving and validating NONMEM data sets. While assembling 
data, a set of functions are provided to mutate common NONMEM variables:

- `mutate_egfr()` adds an estimated glomerular filtration rate (eGFR) column

Once derived, `mrgda` will help you identify any common errors that exist in 
the data, by providing:

- `nm_summary()` outputs covariate summary tables and informative data visualizations

- `nm_validate()` runs a series of pass/fail checks for:
  - Duplicated events
  - Non-unique baseline covariates
  - Missing covariates

These all leverage information within a data specification file. It is suggested
that this file be in `yaml` format, similar to the example found [here](https://github.com/metrumresearchgroup/mrgda/blob/main/inst/derived/pk.yml).
You can learn more about setting up the data specification file in the 
[Getting Started with mrgda](https://metrumresearchgroup.github.io/mrgda/articles/getting-started.html) vignette.


## Usage

```{r, include=FALSE}

nm_spec <- yspec::ys_load(system.file("derived", "pk.yml", package = "mrgda"))
nm <- readr::read_csv(system.file("derived", "pk.csv", package = "mrgda"), na = ".", show_col_types = FALSE)
nm_errors <- readr::read_csv(system.file("derived", "pk-errors.csv", package = "mrgda"), na = ".", show_col_types = FALSE)

nm_ex_df <- dplyr::tibble(
     AGE = c(45, 82, 73),
     WT = c(64, 23, 92),
     SC = c(1.02, 1.04, 1.98),
     SEX = c(1, 2, 1),
     RACE = c(1, 2, 3))

```

#### Data validation

`nm_validate()` outputs the results of the pass/fail checks. If a check fails,
the user will be provided code to help identify where the error is in the data.

```{r, comment=NA}
library(mrgda)

nm_validate(.data = nm_errors, .spec = nm_spec, .error_on_fail = FALSE)

```

#### Data derivation

Data assembly functions such as `mutate_egfr()` mutates a new column onto the data. 
The user is also provided the source for the equation used in the caluclation.

```{r, comment=NA}
nm_ex_df %>% 
  mutate_egfr(
    .age = AGE,
    .wt = WT,
    .serum_creatinine = SC,
    .sex = SEX,
    .female_value = 1
  )
```


## Documentation
Public documentation of all functions is hosted at [https://metrumresearchgroup.github.io/mrgda/](https://metrumresearchgroup.github.io/mrgda/)


## Development

`mrgda` uses [pkgr](https://github.com/metrumresearchgroup/pkgr) to manage
development dependencies and [renv](https://rstudio.github.io/renv/) to
provide isolation. To replicate this environment,

1.  clone the repo

2.  install pkgr

3.  open package in an R session and run `renv::init(bare = TRUE)`

    -   install `renv` \> 0.8.3-4 into default `.libPaths()` if not
        already installed

4.  run `pkgr install` in terminal within package directory

5.  restart session

Then, launch R with the repo as the working directory (open the project
in RStudio). renv will activate and find the project library.

## Getting help

If you encounter a clear bug, please file an issue with a minimal reproducible example on [mrgda](https://github.com/mrgda/issues). 

```{r setup, include = FALSE}
## Package coverage
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
if (basename(getwd()) == "docs") {
  knitr::opts_knit$set(root.dir = file.path(getwd(), ".."))
}

```

```{r, include=FALSE}
covr::package_coverage()
```
